<html>
    <title>Farmer Page</title>
    <!--jquery-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <!--datatables-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <!--bootstrap-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.3/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.3/js/bootstrap-select.js"></script>
    <body>
        <h3>My Cattles</h3>
		<table id="cattle-table" class="display" style="width:100%">
        </table>
		<button onclick="location.href='/createCattle.html'">Create Cattle</button>
    </body>
<script type="text/javascript">
    $(document).ready(function() {
        let myself;
		let myFarmerId;
        $.ajax({
            url: "/hlf/api/system/ping"
        }).done(function(data) {
            myself = data.participant;
			//temp = myself.split("#", 1);
			//myFarmerId = temp[1];
		});        

        $('#cattle-table').DataTable( {
            "ajax": {
                url: "/hlf/api/org.example.basic.Cattle",
                dataSrc: ""
            },
            columns: [
                { title:"Cattle ID", data: "cattleId" },
                { title:"Birth Date", data: "birthDate" },
                { title:"Gender", data: "gender" },
                { title:"Breed", data: "breed" },
				//{ title:"Mother", data: "motherCattleId" },
				//{ title:"Father", data: "fatherCattleId" },
				{ title:"Alive Status", data: "isDead" },
				{ title:"Owner", data: "farmerOwner"},
				{ title:"Grade", data: "grade" },
				{ title:"Processor", data: "processor" },
				{ title:"Certificate", data: "certificate" },
                { title:"Action", render: function(data, type, row, meta){
                    let htmlOutput = "";
                    if(row.farmerOwner == "resource:" + myself){ 
                        
                        htmlOutput += "<button onclick='btnUpdateCattle(\""+row.cattleId+"\")'>Update</button>&nbsp;";
						//htmlOutput += "<form id=redirectToUpdateCattle method='POST' action="/ownerUpdateCattle.html" >
						//<input type="hidden" id="cattleIdToUpdate" name="cattleIdToUpdate" value='\""+row.cattleId+"\"' >";
						htmlOutput += "<button onclick='btnDeleteCattle(\""+row.cattleId+"\")'>Delete</button>";
                    }
                    return htmlOutput;
                  }
                }
            ]
        });
    });
	
	function btnUpdateCattle(cattleId) {
		sessionStorage.setItem("cattleIdToUpdate",cattleId);
		window.location.href = "/updateCattle.html";
		//alert(localStorage.getItem("cattleIdToUpdate"));
	}
	
	function btnDeleteCattle(cattleId) {
        $.ajax({
            method: "POST",
            url: "/hlf/api/org.example.basic.DeleteCattle",
            data: {
				"$class": "org.example.basic.DeleteCattle",
				"cattle": "resource:org.example.basic.Cattle#"+cattleId
            }
        }).done(function(msg) {
            console.log(msg);
			alert("Cattle " + cattleId + " deleted successfully!");
            location.reload();
        }).fail(function() {
            alert("Error performing delete cattle");
        })
    }
    
</script>
</html>